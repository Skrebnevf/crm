- entity_name = controller.controller_name.singularize.underscore
- @entity = instance_variable_get("@#{entity_name}")
- id = dom_id(@entity)

- if params[:cancel].true?
  $('##{id}').replaceWith('#{ j render(partial: entity_name, collection: [ @entity ]) }');

- else
  - if params[:cancel].blank?
    - if @previous
      - if @previous.is_a?(@entity.class)
        $('##{dom_id(@previous)}').replaceWith('#{ j render(partial: entity_name, collection: [ @previous ]) }');
      - else
        crm.flick('#{entity_name}_#{@previous}', 'remove');
    crm.highlight_off('#{id}');
    crm.hide_form('create_#{entity_name}');
    $('##{id}').html('#{ j render(partial: "edit") }');
